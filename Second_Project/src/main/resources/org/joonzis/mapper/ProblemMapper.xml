<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.joonzis.mapper.ProblemMapper">
  <select id="selectProblems" resultType="org.joonzis.domain.ProblemVO">
    SELECT * FROM (
      SELECT ROWNUM rn, t.* FROM (
        SELECT id, subject, message, user_nick AS userNick, created_at AS createdAt
          FROM problem
         ORDER BY created_at DESC
      ) t
      WHERE ROWNUM &lt;= #{offset} + #{limit}
    )
    WHERE rn &gt; #{offset}
  </select>

  <select id="countProblems" resultType="int">
    SELECT COUNT(*) FROM problem
  </select>

  <insert id="insertProblem" parameterType="org.joonzis.domain.ProblemVO" useGeneratedKeys="true" keyProperty="id">
    INSERT INTO problem (id, subject, message, user_nick, created_at)
    VALUES (seq_problem.nextval, #{subject}, #{message}, #{userNick}, SYSTIMESTAMP)
  </insert>

  <select id="selectById" parameterType="long" resultType="org.joonzis.domain.ProblemVO">
    SELECT id, subject, message, user_nick AS userNick, created_at AS createdAt
      FROM problem
     WHERE id = #{id}
  </select>
</mapper>
