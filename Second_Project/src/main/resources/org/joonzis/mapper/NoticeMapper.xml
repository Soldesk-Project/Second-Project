<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.joonzis.mapper.NoticeMapper">
  <select id="selectNotices" resultType="org.joonzis.domain.NoticeVO">
    SELECT * FROM (
      SELECT ROWNUM rn, t.* FROM (
        SELECT id, subject, message, created_at AS createdAt
          FROM notice
         ORDER BY created_at DESC
      ) t
      WHERE ROWNUM &lt;= #{offset} + #{limit}
    )
    WHERE rn &gt; #{offset}
  </select>

  <select id="countNotices" resultType="int">
    SELECT COUNT(*) FROM notice
  </select>

  <insert id="insertNotice" parameterType="org.joonzis.domain.NoticeVO" useGeneratedKeys="true" keyProperty="id">
    INSERT INTO notice (id, subject, message, created_at)
    VALUES (seq_notice.nextval, #{subject}, #{message}, SYSTIMESTAMP)
  </insert>

  <select id="selectById" parameterType="long" resultType="org.joonzis.domain.NoticeVO">
    SELECT id, subject, message, created_at AS createdAt
      FROM notice
     WHERE id = #{id}
  </select>
</mapper>
