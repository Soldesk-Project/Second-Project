<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
         "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.joonzis.mapper.InquiryFileMapper">

	<resultMap id="inquiryFileResultMap" type="org.joonzis.domain.InquiryFileVO">
      <id property="fileId" column="file_id"/>
      <result property="inquiryId" column="inquiry_id"/>
      <result property="filename" column="filename"/>
      <result property="filepath" column="filepath"/>
      <result property="uploadedAt" column="uploaded_at"/>
  </resultMap>

	<!-- fileId를 시퀀스로 생성한 뒤, inquiry_file 테이블에 메타정보 INSERT -->
	<insert id="insertFile" parameterType="org.joonzis.domain.InquiryFileVO">
		<selectKey keyProperty="fileId" resultType="long" order="BEFORE">
			SELECT seq_inquiry_file.NEXTVAL FROM dual
		</selectKey>
		INSERT INTO inquiry_file
			( file_id, inquiry_id, filename, filepath, uploaded_at)
		VALUES
			( #{fileId}, #{inquiryId}, #{filename}, #{filepath}, SYSDATE)
	</insert>
	
	<select id="selectFilesByInquiryId" resultMap="inquiryFileResultMap">
	SELECT 
		file_id, 
		inquiry_id, 
		filename, 
		filepath, 
		uploaded_at
	FROM 
		inquiry_file
	WHERE 
		inquiry_id = #{inquiryId}
	ORDER BY 
		uploaded_at ASC
	</select>
</mapper>
